# Mapping — Pane → (ResolvedGrammar, ResolvedControls)

This table enumerates how each ThoughtSpec pane influences the compiled artifacts. It serves as the “no dead knobs” proof: every control that the UI exposes must map to a grammar or control field, influence generator decisions, and correspond to an audible metric.

| Pane (No. Name) | ThoughtSpec fields | Grammar fields influenced | Controls fields produced/updated | Must‑move metrics impacted | Notes / repairs |
| --- | --- | --- | --- | --- | --- |
| 01 Identity | `thought.identity.thoughtId`, `thought.identity.label`, `thought.identity.enabled`, `thought.identity.frozen` | – | – | – | Metadata only; has no direct audio effect. |
| 02 Style Family & Variant | `thought.style.inheritFromUpstream`, `thought.style.styleFamilyId`, `thought.style.styleVariantId`, `thought.style.allowOverrides`, `thought.style.overridePatch` | Sets `ResolvedGrammar.*` libraries and presets; selects styleFamily and variant, which determine harmonyGrammar, rhythmGrammar, etc. | – | style_conformance metrics (e.g., groove_match, chord_palette) indirectly depend on style selection. | Controls which grammar instance is loaded; `overridePatch` may tighten grammar in expert mode. |
| 03 Profile (Bias) | `thought.profile.inheritFromUpstream`, `thought.profile.profileId`, `thought.profile.biasOverrides` | Bias presets re‑weight progression templates, function transitions, rhythmic archetypes and pitch weights within grammar ranges. | Contributes to weights in `ResolvedControls.harmony.progressionTemplates`, `.functionTransitions`, `ResolvedControls.rhythm.accentModel`, `ResolvedControls.pitch.pitchWeights`, etc. | progression_archetype_frequency, syncopation_index, pitch_class_histogram, motif_similarity (through bias) | Biases are preferences rather than hard constraints; normalization ensures weights still sum to 1. |
| 04 Bars, Meter, Tempo, Type | `thought.container.bars`, `meterOverride`, `tempoOverrideBpm`, `seed`, `thoughtType` | – | `ResolvedControls.form.phrasePlan.totalBars`, default `ResolvedControls.rhythm.grid` (derived from meter), influences control defaults per `thoughtType`. | event_count, syncopation_index, tempo_bpm | Bars must be ≥1; meterOverride validated against grammar; tempoOverrideBpm clamps humanization jitter; `thoughtType` drives generator routing (melody, harmony, bass, beat, texture). |
| 05 Form & Phrasing | `thought.form.phrasePlan.mode`, `barsPerPhrase`, `peakPosition`, `contourShape`, `climaxLift`, `thought.form.cadencePlan.mode`, `events[]` | May tighten `ResolvedGrammar.formGrammar.phraseGrammar` and cadencePlacementNorms if explicit cadencePlan constrains cadences. | `ResolvedControls.form.phrasePlan` (explicit phrase boundaries and contour targets), `ResolvedControls.form.cadencePlan`; `ResolvedControls.harmony.cadenceConstraints` (derived from cadencePlan). | cadence_type_distribution_at_phrase_ends, cadence_success_rate, phrase_dynamic_correlation, contour_correlation | Explicit plans validated against grammar; illegal cadence types dropped or repaired; phrase boundaries snapped to bar boundaries if necessary. |
| 06 Role | `thought.role.roleBehavior`, `priority`, `interaction.followsHarmony`, `interaction.followsRhythm`, `interaction.callResponseGroup` | – | Influences default register ranges, density caps, and part mapping but does not map to a single `ResolvedControls` path. Implementation uses these values when generating parts. | mean_pitch, density, register_overlap_ratio | Role determines part instrumentation and priority for conflict resolution; repairs may drop low‑priority events if density caps exceeded. |
| 07 Harmony Language | `thought.harmony.progressionTemplateId`, `functionTransitionsPresetId`, `chordQualitiesPresetId`, `chromaticCapsPresetId`, `cadenceConstraintsPresetId`, `harmonicRhythm`, `userChordProgression` | – (selects vocabulary subsets but does not edit grammar) | `ResolvedControls.harmony.progressionTemplates`, `.functionTransitions`, `.chordQualities`, `.chromaticCaps`, `.cadenceConstraints`; may also supply `userChordProgression` to override HarmonyPlanner. | progression_archetype_frequency, function_path_statistics, chord_quality_histogram, non_diatonic_pitch_rate, cadence_type_distribution_at_phrase_ends | Presets are validated against grammar; weights normalized; illegal presets dropped in locked/simple. |
| 08 Figuration / Patterns | `thought.figuration.patternFamilyId`, `patternVariantId`, `intensity`, `params` | – | `ResolvedControls.rhythm.accentModel` (pattern archetype), `ResolvedControls.motif.transformPlan` and `motifReusePlan` may be influenced; figuration intensity guides density and arpeggiation. | motif_similarity, onset_ngram_stability, accent_contrast | Pattern presets validated; intensity clamps parameter ranges; illegal patterns removed. |
| 09 Pitch / Tonality | `thought.pitch.tonalCenterPolicy`, `scaleOverride`, `chordToneStrength`, `nonChordToneRateMax`, `nonDiatonicRateMax`, `cadenceTargets.*`, `range.minMidi/maxMidi`, `voiceLeading.maxLeap`, `preferStepwise`, `resolveLeadingTone` | May narrow `ResolvedGrammar.pitchGrammar.scaleVocabulary` and voiceLeadingHardRules (e.g., tighten maxLeap, enforce leading tone resolution). | `ResolvedControls.pitch.allowedPitchClasses`, `.pitchWeights` (from chordToneStrength), `.voiceLeadingRules`, `ResolvedControls.harmony.chromaticCaps` via nonChordToneRateMax and nonDiatonicRateMax, `ResolvedControls.harmony.cadenceConstraints` via cadenceTargets. | pitch_class_histogram, non_diatonic_pitch_rate, interval_histogram, chord_tone_ratio, cadence_target_accuracy | Range validated against instrument; maxLeap cannot exceed grammar cap; cadenceTargets ensure cadences emphasize specified scale degrees. |
| 10 Rhythm (Placement) | `thought.rhythm.grid`, `density`, `syncopation`, `swing`, `restPolicy.minRestBeatsPerBar`, `restPolicy.allowAnticipations`, `accent.preferStrongBeats`, `accent.backbeatBias` | – | `ResolvedControls.rhythm.grid`, `.onsetMask`, `.accentModel`, `.microtimingProfile` (swing), cross‑cap with `ResolvedControls.performance.timingVariance`. | syncopation_index, backbeat_strength, swing_ratio, rest_ratio, quantization_error | Grid validated; onsetMask tightened; microtimingProfile swing values map to rhythm controls; repairs drop illegal onsets or resample accent archetypes. |
| 11 Register (Tessitura) | `thought.register.center`, `span`, `climaxLift`, `octaveBias.preferredOctaves[]`, `octaveBias.penalizeOuterOctaves` | – | `ResolvedControls.pitch.voiceLeadingRules.register` (min/max MIDI), influences pitchPlan register range and climax lift. | mean_pitch, register_span, climax_register_lift | Register bounds clamped to instrument range; preferredOctaves influences pitch weights softly rather than hard caps. |
| 12 Contour (Macro Shape) | `thought.contour.shape`, `motion`, `smoothness`, `targets.phraseStart`, `targets.phraseEnd`, `targets.peakPosition` | – | `ResolvedControls.form.phrasePlan.peakPosition`, contourShape, climaxLift; influences `ResolvedControls.pitch.voiceLeadingRules` preferences. | contour_correlation, smoothness_metric, phrase_dynamic_correlation | Targets outside 0..1 are clamped; shape maps to contour archetypes; smoothness influences scoring in PitchSelector. |
| 13 Motive & Variation | `thought.motif.scheme`, `variation`, `repeatStrength`, `transformAllow[]` | – | `ResolvedControls.motif.motifReusePlan`, `.transformPlan` | motif_similarity, motif_variation_distribution, onset_ngram_stability | Scheme validated against grammar allowedTransforms; variation amount clamps transform magnitude caps; repeatStrength biases motif reuse plan. |
| 14 Performance & Rendering | `thought.performance.microtimingProfile`, `thought.performance.timingVariance`, `thought.performance.velocityCurve`, `thought.performance.articulationBias`, `thought.render.partInstrument`, `thought.render.mixer` | – | `ResolvedControls.rhythm.microtimingProfile` (pocket/swing/jitter), `ResolvedControls.performance.timingVariance`, `ResolvedControls.performance.velocityCurve`; articulationBias may constrain performance grammar; `render.*` routed to renderer. | quantization_error, swing_ratio, timing_jitter_std_ms, velocity_mean_and_range, accent_contrast | MicrotimingProfile values are mapped to rhythm controls (not performance). Legacy `performance.microtimingProfile` fields are remapped. Instrument/mixer have no controls path but must still be implemented by renderer. |

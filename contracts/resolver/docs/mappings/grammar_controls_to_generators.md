# Mapping — (ResolvedGrammar, ResolvedControls) → Generators

Each generator stage reads specific control and grammar fields, makes deterministic decisions, emits trace entries, and updates metrics. This table records those relationships.

| Generator stage | Grammar fields read | Controls fields read | Decisions made | Trace entries emitted | Metrics updated |
| --- | --- | --- | --- | --- | --- |
| **FormPlanner** | `ResolvedGrammar.formGrammar.phraseGrammar`, `ResolvedGrammar.formGrammar.sectionArchetypes`, `ResolvedGrammar.harmonyGrammar.cadenceTypology` | `ResolvedControls.form.phrasePlan`, `ResolvedControls.form.cadencePlan` | Determine totalBars, choose phrase boundaries, apply contour targets, validate cadence plan | phrase boundary choices, cadence repairs | phrase_boundary_positions, contour_correlation |
| **HarmonyPlanner** | `ResolvedGrammar.harmonyGrammar.functionStateMachine`, `progressionTemplateLibrary`, `chordVocabulary`, `cadenceTypology`, `chromaticPolicy`, `ResolvedGrammar.formGrammar.cadencePlacementNorms` | `ResolvedControls.harmony.functionTransitions`, `progressionTemplates`, `chordQualities`, `chromaticCaps`, `cadenceConstraints`, `ResolvedControls.form.cadencePlan` | Choose harmonic rhythm model, pick progression templates, generate function path (T/PD/D), realize chords, place cadences, validate/repair plan | template selection, function path decisions, chord quality repairs, cadence repairs | progression_archetype_frequency, function_path_statistics, chord_quality_histogram, non_diatonic_pitch_rate, cadence_type_distribution_at_phrase_ends, cadence_success_rate |
| **RhythmRealizer** | `ResolvedGrammar.rhythmGrammar.meter`, `gridPolicy`, `onsetLegality`, `accentGrammar`, `grooveTemplates`, `ResolvedGrammar.performanceGrammar.humanizationBounds` | `ResolvedControls.rhythm.grid`, `onsetMask`, `accentModel`, `microtimingProfile`; `ResolvedControls.performance.timingVariance` | Compute tick lattice, build legal onset set, sample onset sequences per part with density/syncopation/rest/accent biases, apply microtiming (swing/pocket/jitter) subject to timing variance | onset mask repairs, microtiming clamping decisions | syncopation_index, backbeat_strength, rest_ratio, swing_ratio, quantization_error |
| **MotifPlanner** | `ResolvedGrammar.motifGrammar.allowedTransforms`, `transformMagnitudeCaps`, `reuseExpectations` | `ResolvedControls.motif.motifReusePlan`, `transformPlan`, `ResolvedControls.form.phrasePlan`, optional `ResolvedControls.rhythm.onsetMask` | Realize motif scheme (AAAA, AABA, etc.), set similarity targets per phrase, assign transforms per phrase and clamp magnitudes, validate reuse against expectations | motif reuse plan, transform usage repairs | motif_similarity |
| **PitchSelector** | `ResolvedGrammar.pitchGrammar.scaleVocabulary`, `voiceLeadingHardRules`, `ResolvedGrammar.harmonyGrammar.chordVocabulary`, `chromaticPolicy` | `ResolvedControls.pitch.allowedPitchClasses`, `pitchWeights`, `voiceLeadingRules`, `ResolvedControls.harmony.chromaticCaps`, `ResolvedControls.form.phrasePlan`, `cadencePlan`, `ResolvedControls.rhythm.onsetMask` | Build legal pitch class set, define scoring function for candidate MIDI notes (pc weights, chord‑tone bonuses, contour targets, cadence targets, voice‑leading penalties, chromatic penalties), choose notes per onset, validate and repair illegal pitches, leaps and caps | pitch selection choices, leap repairs | pitch_class_histogram, interval_histogram, chord_tone_ratio, non_diatonic_pitch_rate |
| **PerformanceHumanizer** | `ResolvedGrammar.performanceGrammar.humanizationBounds`, `articulationNorms` | `ResolvedControls.performance.timingVariance`, `velocityCurve`, `ResolvedControls.rhythm.microtimingProfile`, `ResolvedControls.rhythm.accentModel`, `ResolvedControls.form.phrasePlan` | Apply timing offsets: pocket bias, swing ratio, jitter; clamp to bounds; apply velocity curve: base velocity, crescendo/arch per phrase, accent scaling; respect articulation norms | timing offset clamping, velocity curve clamping | timing_jitter_std_ms, swing_ratio, velocity_mean_and_range, accent_contrast |
| **PartAssembler** | – (validates but does not read grammar) | – (reads all plans and events produced so far) | Align plans, allocate harmony voicings, resolve register conflicts and density conflicts, merge traces and metrics | collision repairs, density drops, final trace concatenation | pitch_class_histogram, chord_tone_ratio, non_diatonic_pitch_rate, interval_histogram, syncopation_index, backbeat_strength, swing_ratio, cadence distributions, motif_similarity |
